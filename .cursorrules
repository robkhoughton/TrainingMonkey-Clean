# TrainingMonkey Project Rules for Cursor

## üóÑÔ∏è Database Standards (CRITICAL)
- **PostgreSQL ONLY**: Use `%s` placeholders (NOT `?`), `SERIAL PRIMARY KEY` (NOT `AUTOINCREMENT`), `NOW()` (NOT `CURRENT_TIMESTAMP`)
- **Schema Changes**: Assistant can run migrations using `app/run_migration.py` or direct SQL via `db_utils`. Never modify schema in application code.
- **Date Operations**: Use `datetime.now().date()` for date-only operations, `'YYYY-MM-DD'` format for APIs
- **Connection**: DATABASE_URL loaded from `.env` file via `app/db_credentials_loader.py` (secure, not in version control)
- **Direct Database Access**: Assistant can execute database operations using existing `db_utils` module or migration scripts

## üîê Database Access Methods (for AI Assistant)
1. **Schema Migrations**: Create migration script in `app/` using `db_credentials_loader` and `db_utils`
2. **Query Execution**: Use `db_utils.execute_query()` with parameterized queries
3. **Data Inspection**: Use `db_utils` for read operations to verify state
4. **Credential Loading**: Always use `from db_credentials_loader import set_database_url` for secure access
5. **Never Hardcode**: Never put DATABASE_URL or credentials in code files

## üîß Code Quality Standards
- **Public APIs**: Use intended public methods, avoid private method calls
- **Error Handling**: Provide meaningful error messages, fail gracefully
- **SQL Injection**: Always use parameterized queries with `%s` placeholders
- **Transactions**: Use explicit commits and context managers for database connections

## üöÄ Development Workflow
- **Root Cause Analysis**: Check database state before making assumptions
- **End-to-End Testing**: Test complete user flows, not just components
- **Validation**: Run `validate_sql_syntax.py` before commits
- **Clean Code**: Remove debugging artifacts, use proper validation
- **Deployment**: User handles all deployments. Assistant prepares code changes but NEVER runs deployment commands

## üìã Timezone & Date Standards
- **Storage**: UTC timestamps in database
- **Application**: Use `get_app_current_date()` for consistent date handling
- **APIs**: Return dates in `'YYYY-MM-DD'` format
- **Debugging**: Use `log_timezone_debug()` for timezone issues

## ‚ùå Common Mistakes to Avoid
- Using SQLite syntax (`?`, `AUTOINCREMENT`, `CURRENT_TIMESTAMP`)
- Calling private methods from outside their class
- Making schema changes in application code (use migration scripts instead)
- Using `datetime.now()` for date-only operations
- Inconsistent date formats in API responses
- Hardcoding DATABASE_URL or credentials in any file
- Running database operations without loading credentials via `db_credentials_loader`

## üéØ Success Criteria
- All SQL queries use PostgreSQL syntax
- All date operations use proper date objects
- All APIs return consistent formats
- All schema changes via migration scripts (assistant can run these)
- Clean error handling and logging
- Database credentials loaded securely from .env file

## üìä Database Operation Examples

### ‚úÖ Correct: Schema Migration
```python
# In app/my_migration.py
from db_credentials_loader import set_database_url
import db_utils

set_database_url()  # Load from .env
db_utils.execute_query("ALTER TABLE activities ADD COLUMN new_field TEXT")
```

### ‚úÖ Correct: Data Query
```python
from db_credentials_loader import set_database_url
import db_utils

set_database_url()
results = db_utils.execute_query(
    "SELECT * FROM activities WHERE user_id = %s", 
    (user_id,), 
    fetch=True
)
```

### ‚ùå Wrong: Hardcoded Credentials
```python
# NEVER DO THIS
os.environ['DATABASE_URL'] = 'postgresql://user:pass@host/db'
```