<!DOCTYPE html>
<html>
<head>
    <title>Connect Strava - Your Training Monkey</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 700px;
            margin: 30px auto;
            padding: 20px;
            line-height: 1.6;
            color: #333;
        }
        .info-box {
            background: #e7f3ff;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #2196F3;
        }
        .form-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        .warning-box {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #ffc107;
        }
        .form-group {
            margin: 15px 0;
        }
        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            color: #495057;
        }
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.15s ease-in-out;
            box-sizing: border-box;
        }
        .form-group input:focus {
            outline: none;
            border-color: #FC5200;
            box-shadow: 0 0 0 2px rgba(252, 82, 0, 0.1);
        }
        .strava-button-container {
            text-align: center;
            margin: 30px 0;
        }
        .strava-button-wrapper {
            display: inline-block;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        .strava-button-wrapper:hover {
            transform: scale(1.05);
        }
        .strava-button-wrapper img {
            height: 48px;
            width: auto;
        }
        .back-link {
            display: inline-block;
            margin-top: 30px;
            color: #6c757d;
            text-decoration: none;
            padding: 10px 0;
        }
        .back-link:hover {
            color: #495057;
            text-decoration: underline;
        }
        .strava-branding {
            text-align: center;
            margin: 40px 0 20px 0;
            padding: 20px 0;
            border-top: 1px solid #e9ecef;
        }
        .strava-logo {
            height: 20px;
            width: auto;
        }
        /* Progress Section Styles */
        .progress-section {
            background: #f8fafc;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid #e2e8f0;
        }

        .progress-header {
            margin-bottom: 1.5rem;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
        }

        .step {
            flex: 1;
            text-align: center;
            position: relative;
        }

        .step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 20px;
            left: calc(50% + 20px);
            right: calc(-50% + 20px);
            height: 2px;
            background: #e2e8f0;
            z-index: 1;
        }

        .step.completed:not(:last-child)::after {
            background: #10b981;
        }

        .step-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 0.75rem auto;
            font-weight: 600;
            font-size: 1rem;
            position: relative;
            z-index: 2;
        }

        .step.completed .step-icon {
            background: #10b981;
            color: white;
        }

        .step.current .step-icon {
            background: #667eea;
            color: white;
        }

        .step.upcoming .step-icon {
            background: #e2e8f0;
            color: #6c757d;
        }

        .step-content {
            text-align: center;
        }

        .step-title {
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }

        .step-desc {
            color: #6c757d;
            font-size: 0.8rem;
        }

        .step.completed .step-title {
            color: #10b981;
        }

        .step.current .step-title {
            color: #667eea;
        }

        /* FAQ Section Styles */
        .faq-section {
            background: #f8fafc;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 2rem 0;
            border: 1px solid #e2e8f0;
        }

        .faq-item {
            margin-bottom: 1rem;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
            background: white;
        }

        .faq-question {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 1.25rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
            user-select: none;
        }

        .faq-question:hover {
            background: #f8fafc;
        }

        .faq-icon {
            font-size: 1.1rem;
            flex-shrink: 0;
        }

        .faq-text {
            flex: 1;
            font-weight: 500;
            color: #2c3e50;
            font-size: 0.95rem;
        }

        .faq-toggle {
            font-size: 1.2rem;
            font-weight: bold;
            color: #667eea;
            transition: transform 0.2s ease;
            flex-shrink: 0;
        }

        .faq-item.active .faq-toggle {
            transform: rotate(45deg);
        }

        .faq-answer {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            background: #f8fafc;
        }

        .faq-item.active .faq-answer {
            max-height: 200px;
        }

        .faq-answer p {
            padding: 1rem 1.25rem;
            margin: 0;
            color: #64748b;
            line-height: 1.5;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            body {
                margin: 15px;
                padding: 15px;
            }
            .info-box, .form-box, .warning-box, .progress-section {
                padding: 15px;
            }
            .progress-steps {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            .step:nth-child(1)::after,
            .step:nth-child(2)::after,
            .step:nth-child(3)::after {
                display: none;
            }
            .step-icon {
                width: 35px;
                height: 35px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <h1 style="color: #2c3e50; margin-bottom: 10px;">Connect Your Strava Account</h1>
    <p style="color: #6c757d; margin-bottom: 30px;">Set up your personal connection to sync training data with Your Training Monkey</p>

    <!-- Progress Indicator -->
    <div class="progress-section">
        <div class="progress-header">
            <h3 style="color: #2c3e50; margin: 0; text-align: center;">Getting You Set Up</h3>
            <p style="color: #6c757d; margin: 0.5rem 0 0 0; text-align: center; font-size: 0.9rem;">Step 1 of 3 ‚Ä¢ Let's get started!</p>
        </div>
        <div class="progress-steps">
            <div class="step current">
                <div class="step-icon">1</div>
                <div class="step-content">
                    <div class="step-title">Connect Strava</div>
                    <div class="step-desc">Link your training data</div>
                </div>
            </div>
            <div class="step upcoming">
                <div class="step-icon">2</div>
                <div class="step-content">
                    <div class="step-title">Setup Preferences</div>
                    <div class="step-desc">Enter goals and preferences</div>
                </div>
            </div>
            <div class="step upcoming">
                <div class="step-icon">3</div>
                <div class="step-content">
                    <div class="step-title">Welcome</div>
                    <div class="step-desc">All set - redirected to Dashboard</div>
                </div>
            </div>
        </div>
    </div>

    <div class="info-box">
        <h3 style="margin-top: 0; color: #1976d2;">üîë Step 1: Create Your Personal Strava App</h3>
        <p>Each user needs their own Strava application (this is temporary while we wait for multi-user approval).</p>
        <ol style="margin: 15px 0;">
            <li>Go to <a href="https://www.strava.com/settings/api" target="_blank" style="color: #FC5200; font-weight: 500;">Strava API Settings</a></li>
            <li>Click <strong>"Create App"</strong></li>
            <li>Fill in the form with these exact values:
                <ul style="margin: 10px 0; padding-left: 20px;">
                    <li><strong>Application Name:</strong> [Your choice, e.g. "My Training Monkey"]</li>
                    <li><strong>Category:</strong> Training</li>
                    <li><strong>Club:</strong> [Leave blank]</li>
                    <li><strong>Website:</strong> <code>https://yourtrainingmonkey.com</code></li>
                    <li><strong>Application Description:</strong> Personal training analytics dashboard</li>
                    <li><strong>Authorization Callback Domain:</strong> <code>yourtrainingmonkey.com</code></li>
                </ul>
            </li>
            <li>Click <strong>"Create"</strong></li>
            <li>Copy your <strong>Client ID</strong> and <strong>Client Secret</strong> from the app details page</li>
        </ol>
    </div>

    <div class="form-box">
        <h3 style="margin-top: 0; color: #495057;">üîó Step 2: Enter Your App Credentials</h3>
        <form method="POST" id="stravaForm">
            <div class="form-group">
                <label for="client_id">Client ID</label>
                <input type="text" 
                       id="client_id" 
                       name="client_id" 
                       required 
                       placeholder="Enter your Strava app Client ID">
            </div>

            <div class="form-group">
                <label for="client_secret">Client Secret</label>
                <input type="text" 
                       id="client_secret" 
                       name="client_secret" 
                       required 
                       placeholder="Enter your Strava app Client Secret">
            </div>

            <!-- OFFICIAL STRAVA CONNECT BUTTON -->
            <div class="strava-button-container">
                <div class="strava-button-wrapper" onclick="submitStravaForm()">
                    <img 
                        src="/static/connect-with-strava-orange.svg" 
                        alt="Connect with Strava"
                        class="strava-connect-button"
                        onerror="handleButtonError(this)"
                    >
                </div>
            </div>
        </form>
    </div>

    <div class="warning-box">
        <h4 style="margin-top: 0; color: #856404;">‚ÑπÔ∏è Why do I need my own app?</h4>
        <p style="margin-bottom: 0;">This is a temporary setup while we wait for Strava to approve our application for multiple users. Once approved, this step won't be necessary and you'll connect with a single click.</p>
    </div>

    <!-- FAQ Section -->
    <div class="faq-section">
        <h3 style="color: #2c3e50; margin-bottom: 1.5rem; text-align: center;">Frequently Asked Questions</h3>
        
        <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
                <span class="faq-icon">‚ùì</span>
                <span class="faq-text">What happens when I click 'Connect with Strava'?</span>
                <span class="faq-toggle">+</span>
            </div>
            <div class="faq-answer">
                <p>You'll be redirected to Strava's secure login page. Simply log in with your Strava credentials and authorize TrainingMonkey to access your activity data.</p>
            </div>
        </div>

        <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
                <span class="faq-icon">‚ùì</span>
                <span class="faq-text">What if I don't have a Strava account?</span>
                <span class="faq-toggle">+</span>
            </div>
            <div class="faq-answer">
                <p>You'll need a Strava account to use TrainingMonkey. If you don't have one, you can create a free account at strava.com. Once you have a Strava account, you'll need to connect it to your fitness device accounts (Garmin Connect, Coros, etc.) to automatically sync your historical training data. Verify that your data has transferred to Strava, then come back to complete the TrainingMonkey connection.</p>
            </div>
        </div>

        <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
                <span class="faq-icon">‚ùì</span>
                <span class="faq-text">Why use TrainingMonkey when I already have Garmin/Coros analytics?</span>
                <span class="faq-toggle">+</span>
            </div>
            <div class="faq-answer">
                <p>While Garmin and Coros provide excellent device-specific analytics, TrainingMonkey offers something unique: <strong>divergence analysis</strong>. We compare your external training load (what you did) against your internal load (how your body responded) to spot dangerous imbalances weeks before they become injuries. Garmin shows you what you did, but we show you if your body can handle it. Our patent-pending technology provides early warning signals that device analytics alone can't detect.</p>
            </div>
        </div>

        <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
                <span class="faq-icon">‚ùì</span>
                <span class="faq-text">Is my Strava data safe? What can TrainingMonkey access?</span>
                <span class="faq-toggle">+</span>
            </div>
            <div class="faq-answer">
                <p>TrainingMonkey only accesses your activity data (distance, time, heart rate) to analyze your training load. We never access personal information, messages, or photos. Your data is encrypted and never shared.</p>
            </div>
        </div>

        <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
                <span class="faq-icon">‚ùì</span>
                <span class="faq-text">How long does the connection take?</span>
                <span class="faq-toggle">+</span>
            </div>
            <div class="faq-answer">
                <p>The entire process takes less than 30 seconds: click the button, log into Strava, authorize the connection, and you're done!</p>
            </div>
        </div>

        <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
                <span class="faq-icon">‚ùì</span>
                <span class="faq-text">When will I see my training analysis?</span>
                <span class="faq-toggle">+</span>
            </div>
            <div class="faq-answer">
                <p>After connecting Strava, we'll start analyzing your data immediately. You'll see basic insights within hours, and full personalized recommendations after we have 28 days of your training data.</p>
            </div>
        </div>

        <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
                <span class="faq-icon">‚ùì</span>
                <span class="faq-text">I'm getting an error when trying to connect. What should I do?</span>
                <span class="faq-toggle">+</span>
            </div>
            <div class="faq-answer">
                <p>Make sure you're logged into the correct Strava account. If you're still having trouble, try refreshing the page or clearing your browser cache.</p>
            </div>
        </div>

        <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
                <span class="faq-icon">‚ùì</span>
                <span class="faq-text">Can I disconnect Strava later if I want to?</span>
                <span class="faq-toggle">+</span>
            </div>
            <div class="faq-answer">
                <p>Absolutely! You can disconnect Strava anytime from your TrainingMonkey settings or directly from your Strava account settings.</p>
            </div>
        </div>
    </div>

    <!-- OFFICIAL STRAVA BRANDING FOOTER -->
    <div class="strava-branding">
        <img 
            src="/static/powered-by-strava-orange.svg" 
            alt="Powered by Strava"
            class="strava-logo"
            onerror="handleLogoError(this)"
        >
    </div>

    <a href="/static/index.html" class="back-link">‚Üê Back to Dashboard</a>

    <script>
    function submitStravaForm() {
        const clientId = document.getElementById('client_id').value.trim();
        const clientSecret = document.getElementById('client_secret').value.trim();

        if (!clientId || !clientSecret) {
            alert('Please enter both Client ID and Client Secret before connecting to Strava.');
            return;
        }

        // Add visual feedback
        const button = document.querySelector('.strava-button-wrapper');
        button.style.opacity = '0.7';
        button.style.transform = 'scale(0.95)';

        // Submit the form
        document.getElementById('stravaForm').submit();
    }

    function handleButtonError(img) {
        // Fallback for Connect button if SVG fails to load
        img.style.display = 'none';
        const fallbackButton = document.createElement('button');
        fallbackButton.innerHTML = 'CONNECT WITH STRAVA';
        fallbackButton.type = 'button';
        fallbackButton.onclick = submitStravaForm;
        fallbackButton.style.cssText = `
            background: #FC5200;
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            height: 48px;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        `;
        fallbackButton.onmouseover = function() {
            this.style.backgroundColor = '#e73c00';
            this.style.transform = 'scale(1.05)';
        };
        fallbackButton.onmouseout = function() {
            this.style.backgroundColor = '#FC5200';
            this.style.transform = 'scale(1)';
        };
        img.parentNode.appendChild(fallbackButton);
    }

    function handleLogoError(img) {
        // Fallback for Powered by Strava logo if SVG fails to load
        img.style.display = 'none';
        const fallbackText = document.createElement('span');
        fallbackText.innerHTML = 'POWERED BY STRAVA';
        fallbackText.style.cssText = `
            font-weight: bold;
            color: #FC5200;
            font-size: 14px;
            letter-spacing: 0.5px;
        `;
        img.parentNode.appendChild(fallbackText);
    }

    // FAQ Toggle Function
    function toggleFAQ(element) {
        const faqItem = element.parentElement;
        const isActive = faqItem.classList.contains('active');
        
        // Close all other FAQ items
        document.querySelectorAll('.faq-item').forEach(item => {
            item.classList.remove('active');
        });
        
        // Toggle current item
        if (!isActive) {
            faqItem.classList.add('active');
        }
    }

    // Form validation feedback
    document.addEventListener('DOMContentLoaded', function() {
        const inputs = document.querySelectorAll('input[required]');
        inputs.forEach(input => {
            input.addEventListener('blur', function() {
                if (this.value.trim() === '') {
                    this.style.borderColor = '#dc3545';
                } else {
                    this.style.borderColor = '#28a745';
                }
            });
        });
    });
    </script>
</body>
</html>
