<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Landing Page ACWR Chart</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/recharts@2.8.0/umd/Recharts.js"></script>
    <style>
        .chart-demo {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin: 2rem 0;
            border: 1px solid #e2e8f0;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .chart-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1e293b;
            margin: 0;
        }

        .chart-subtitle {
            color: #64748b;
            font-size: 0.9rem;
            margin: 0.5rem 0 0 0;
        }

        .chart-container {
            width: 100%;
            height: 400px;
            margin: 1rem 0;
        }

        .chart-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 400px;
            color: #64748b;
            font-size: 1.1rem;
        }

        .chart-error {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 400px;
            color: #ef4444;
            font-size: 1rem;
            background: #fef2f2;
            border-radius: 8px;
            border: 1px solid #fecaca;
        }

        .data-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e2e8f0;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .data-stats {
            color: #64748b;
            font-size: 0.85rem;
        }

        .chart-legend {
            display: flex;
            gap: 2rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            color: #475569;
        }

        .legend-color {
            width: 16px;
            height: 3px;
            border-radius: 2px;
        }

        .zone-info {
            font-size: 0.8rem;
            color: #64748b;
            text-align: center;
            margin-top: 0.5rem;
        }

        @media (max-width: 768px) {
            .chart-header {
                flex-direction: column;
                text-align: center;
            }

            .chart-container {
                height: 300px;
            }

            .data-info {
                flex-direction: column;
                text-align: center;
            }

            .chart-legend {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div id="acwr-chart-root"></div>

    <script>
        // Ensure all libraries are loaded
        if (typeof React === 'undefined' || typeof ReactDOM === 'undefined' || typeof Recharts === 'undefined') {
            document.getElementById('acwr-chart-root').innerHTML = `
                <div class="chart-demo">
                    <div class="chart-error">
                        Chart libraries not loaded. Please refresh the page.
                    </div>
                </div>
            `;
        } else {
            const { useState, useEffect, createElement } = React;
            const { ResponsiveContainer, LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ReferenceArea } = Recharts;

            const ACWRLandingChart = () => {
                const [data, setData] = useState([]);
                const [loading, setLoading] = useState(true);
                const [error, setError] = useState(null);
                const [chartInfo, setChartInfo] = useState(null);

                // Chart theme colors (matching your app)
                const colors = {
                    primary: '#3b82f6',    // External ACWR
                    trimp: '#8b5cf6',      // Internal ACWR
                    danger: '#ef4444',     // High risk zone
                    warning: '#f59e0b',    // Moderate risk zone
                    success: '#10b981',    // Optimal zone
                    secondary: '#6b7280'   // Low load zone
                };

                useEffect(() => {
                    fetchChartData();
                }, []);

                const fetchChartData = async () => {
                    try {
                        setLoading(true);
                        setError(null);

                        const response = await fetch('/api/landing-chart-data');

                        if (!response.ok) {
                            throw new Error(`Failed to load data: ${response.status}`);
                        }

                        const result = await response.json();

                        if (result.success && result.data) {
                            setData(result.data);
                            setChartInfo({
                                dataPoints: result.dataPoints,
                                dateRange: result.dateRange
                            });
                        } else {
                            throw new Error(result.error || 'Failed to load chart data');
                        }
                    } catch (err) {
                        console.error('Chart data fetch error:', err);
                        setError(err.message);
                    } finally {
                        setLoading(false);
                    }
                };

                const CustomTooltip = ({ active, payload, label }) => {
                    if (!active || !payload || !payload.length) return null;

                    const data = payload[0].payload;
                    const date = new Date(data.date);
                    const formattedDate = date.toLocaleDateString('en-US', {
                        weekday: 'short',
                        month: 'short',
                        day: 'numeric'
                    });

                    return createElement('div', {
                        style: {
                            backgroundColor: 'white',
                            border: '2px solid #3b82f6',
                            borderRadius: '8px',
                            padding: '12px',
                            boxShadow: '0 4px 12px rgba(0,0,0,0.15)',
                            minWidth: '200px'
                        }
                    }, [
                        createElement('p', {
                            key: 'date',
                            style: { fontWeight: 'bold', marginBottom: '8px', color: '#1e293b' }
                        }, formattedDate),
                        data.name && createElement('p', {
                            key: 'name',
                            style: { fontSize: '0.85rem', marginBottom: '4px', color: '#64748b' }
                        }, data.name),
                        createElement('p', {
                            key: 'details',
                            style: { fontSize: '0.85rem', marginBottom: '8px', color: '#64748b' }
                        }, `${data.type} • ${data.distance_miles}mi • ${data.elevation_gain_feet}ft`),
                        createElement('p', {
                            key: 'external',
                            style: { marginBottom: '4px', color: colors.primary }
                        }, [
                            createElement('strong', { key: 'label' }, 'External ACWR: '),
                            payload[0].value?.toFixed(2)
                        ]),
                        createElement('p', {
                            key: 'internal',
                            style: { marginBottom: '4px', color: colors.trimp }
                        }, [
                            createElement('strong', { key: 'label' }, 'Internal ACWR: '),
                            payload[1]?.value?.toFixed(2)
                        ]),
                        createElement('p', {
                            key: 'trimp',
                            style: { fontSize: '0.8rem', marginTop: '8px', color: '#64748b' }
                        }, `TRIMP: ${data.trimp}`)
                    ]);
                };

                if (loading) {
                    return createElement('div', { className: 'chart-demo' },
                        createElement('div', { className: 'chart-loading' },
                            'Loading real training data...'
                        )
                    );
                }

                if (error) {
                    return createElement('div', { className: 'chart-demo' },
                        createElement('div', { className: 'chart-error' },
                            `Unable to load chart: ${error}`
                        )
                    );
                }

                return createElement('div', { className: 'chart-demo' }, [
                    createElement('div', { key: 'header', className: 'chart-header' }, [
                        createElement('div', { key: 'title-section' }, [
                            createElement('h3', {
                                key: 'title',
                                className: 'chart-title'
                            }, 'Real Training Data: ACWR Analysis'),
                            createElement('p', {
                                key: 'subtitle',
                                className: 'chart-subtitle'
                            }, 'Live data from our founder\'s trail running training - see how the system tracks training load balance')
                        ])
                    ]),

                    createElement('div', { key: 'chart', className: 'chart-container' },
                        createElement(ResponsiveContainer, { width: '100%', height: '100%' },
                            createElement(LineChart, {
                                data: data,
                                margin: { top: 20, right: 30, left: 20, bottom: 20 }
                            }, [
                                createElement(CartesianGrid, {
                                    key: 'grid',
                                    strokeDasharray: '3 3',
                                    stroke: '#f1f5f9'
                                }),

                                createElement(XAxis, {
                                    key: 'xaxis',
                                    dataKey: 'dateFormatted',
                                    tick: { fontSize: 12 },
                                    interval: 'preserveStartEnd'
                                }),

                                createElement(YAxis, {
                                    key: 'yaxis',
                                    domain: [0.4, 1.8],
                                    tick: { fontSize: 12 },
                                    label: {
                                        value: 'ACWR',
                                        angle: -90,
                                        position: 'insideLeft',
                                        style: { textAnchor: 'middle' }
                                    }
                                }),

                                createElement(Tooltip, {
                                    key: 'tooltip',
                                    content: createElement(CustomTooltip)
                                }),

                                createElement(Legend, { key: 'legend' }),

                                // Risk Zones
                                createElement(ReferenceArea, {
                                    key: 'high-risk',
                                    y1: 1.5,
                                    y2: 1.8,
                                    fill: colors.danger,
                                    fillOpacity: 0.1,
                                    stroke: colors.danger,
                                    strokeOpacity: 0.3
                                }),

                                createElement(ReferenceArea, {
                                    key: 'moderate-risk',
                                    y1: 1.3,
                                    y2: 1.5,
                                    fill: colors.warning,
                                    fillOpacity: 0.1,
                                    stroke: colors.warning,
                                    strokeOpacity: 0.3
                                }),

                                createElement(ReferenceArea, {
                                    key: 'optimal',
                                    y1: 0.8,
                                    y2: 1.3,
                                    fill: colors.success,
                                    fillOpacity: 0.05,
                                    stroke: colors.success,
                                    strokeOpacity: 0.3
                                }),

                                createElement(Line, {
                                    key: 'external-line',
                                    type: 'monotone',
                                    dataKey: 'acute_chronic_ratio',
                                    stroke: colors.primary,
                                    strokeWidth: 3,
                                    dot: { fill: colors.primary, strokeWidth: 2, r: 4 },
                                    name: 'External ACWR (Distance + Elevation)',
                                    connectNulls: false
                                }),

                                createElement(Line, {
                                    key: 'internal-line',
                                    type: 'monotone',
                                    dataKey: 'trimp_acute_chronic_ratio',
                                    stroke: colors.trimp,
                                    strokeWidth: 3,
                                    dot: { fill: colors.trimp, strokeWidth: 2, r: 4 },
                                    name: 'Internal ACWR (Heart Rate Based)',
                                    connectNulls: false
                                })
                            ])
                        )
                    ),

                    createElement('div', { key: 'zone-info', className: 'zone-info' }, [
                        createElement('strong', { key: 'label' }, 'Training Zones: '),
                        createElement('span', {
                            key: 'optimal',
                            style: { color: colors.success }
                        }, ' ● Optimal (0.8-1.3)'),
                        ' • ',
                        createElement('span', {
                            key: 'moderate',
                            style: { color: colors.warning }
                        }, ' ● Moderate Risk (1.3-1.5)'),
                        ' • ',
                        createElement('span', {
                            key: 'high',
                            style: { color: colors.danger }
                        }, ' ● High Risk (>1.5)')
                    ]),

                    chartInfo && createElement('div', { key: 'info', className: 'data-info' }, [
                        createElement('div', { key: 'stats', className: 'data-stats' }, [
                            createElement('strong', { key: 'count' }, chartInfo.dataPoints),
                            ' training days • Last 60 days of real data'
                        ]),
                        createElement('div', { key: 'legend', className: 'chart-legend' }, [
                            createElement('div', { key: 'external', className: 'legend-item' }, [
                                createElement('div', {
                                    key: 'color',
                                    className: 'legend-color',
                                    style: { backgroundColor: colors.primary }
                                }),
                                createElement('span', { key: 'label' }, 'External Load (Distance + Terrain)')
                            ]),
                            createElement('div', { key: 'internal', className: 'legend-item' }, [
                                createElement('div', {
                                    key: 'color',
                                    className: 'legend-color',
                                    style: { backgroundColor: colors.trimp }
                                }),
                                createElement('span', { key: 'label' }, 'Internal Load (Heart Rate Response)')
                            ])
                        ])
                    ])
                ]);
            };

            ReactDOM.render(createElement(ACWRLandingChart), document.getElementById('acwr-chart-root'));
        }
    </script>
</body>
</html>